<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

<canvas id="canvas1" width="1200" height="600"></canvas>
<div id="status"></div>

<script type="text/javascript">
function setPixel(imageData, x, y, r, g, b, a) {
    index = (x + y * imageData.width) * 4;
    imageData.data[index+0] = r;
    imageData.data[index+1] = g;
    imageData.data[index+2] = b;
    imageData.data[index+3] = a;
}

jQuery(document).ready(function() {
    element = document.getElementById("canvas1");
    c = element.getContext("2d");


    // create a new batch of pixels with the same
    // dimensions as the image:
    imageData = c.createImageData(element.width, element.height);

    max_x=1200
    max_y=600
    scale_factor=1

    jQuery("#status").text("calling...");
    jQuery.get("http://worldsim.spiffyte.ch:5000/sample_noise", function(data) {
        jQuery("#status").text("called");
        data = data["grid"];
        for(x=0;x<max_x;x++) {
            for(y=0;y<max_y;y++) {
                for(fx=0;fx<scale_factor;fx++) {
                    for(fy=0;fy<scale_factor;fy++) {
                        if(data[x][y] < 50) {
                            setPixel(imageData, (x*scale_factor)+fx, (y*scale_factor)+fy, 0, 0, 255, 255);
                        } else if(data[x][y] < 200) {
                            setPixel(imageData, (x*scale_factor)+fx, (y*scale_factor)+fy, 0, 255, 0, 255);
                        } else {
                            setPixel(imageData, (x*scale_factor)+fx, (y*scale_factor)+fy, data[x][y], data[x][y], data[x][y], 255);
                        }
                    }
                }
            }
        }
        c.putImageData(imageData, 0, 0);
        jQuery("#status").text("complete");
    });
});

</script>
